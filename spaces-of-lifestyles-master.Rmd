---
title: 'The space of lifestyles in Finland, 2007 and 2018: Continuity and change'
author: "Ossi Sirkka, Semi Purhonen"
date: '`r format(Sys.Date(), "%d. %B %Y")`'
abstract: "Have the ways in which cultural practices are socially structured changed over the last 10–15 years, a period marked by digitization of cultural consumption and production and increased socio-political polarization? This work-in-progress paper tackles this question by analyzing two repeated nationally representative surveys, collected in Finland in 2007 (N=1,388) and 2018 (N=1,425), allowing comparisons over time and including a wide set of indicators of cultural practices. Applying multiple correspondence analysis (MCA), the paper sets out to construct the space of lifestyles – or, “cultural map” – in Finland in both 2007 and 2018. The analysis carried out, inspired by the few studies having used MCA in analyzing temporal changes, includes three steps. First, the space of lifestyles for 2007 is constructed using more than 100 indicators of cultural practices, while the socio-political divisions are projected onto the space as supplementary variables. Second, the space of lifestyles for 2018 is constructed using exactly identical set of indicators as for 2007 to investigate the nature of changes, if measured symmetrically. Third, to reveal the impact of new cultural practices that were not available for the 2007 data, the space of lifestyles for 2018 is constructed again, this time using also a comprehensive set of additional indicators of social media and other online and offline everyday activities. The results are discussed in the light of other recent research focusing on the temporal dynamics of cultural stratification in different national contexts."
keywords: "Cultural practices, space of lifestyles, taste, stratification, change, multiple correspondence analysis"
output: 
  bookdown::html_document2:
  number_sections: TRUE
  fig_caption: TRUE
  pdf_document:
    toc: TRUE
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=14, fig.height=14,
                      dev = "png",
                      fig.path=paste0(getwd(),'/images_for_article/'),
                      echo=FALSE, warning=FALSE, message=FALSE)



```

```{r, load-data}
# Libraries
library(FactoMineR)
library(factoextra)
library(tidyverse)
library(knitr)
library(kableExtra)


# Open the data
path <- paste0(getwd(), "/data_for_mca.RData")
load(path)

vanha <- complete_vanha_aineisto$completeObs
uusi <- complete_uusi_aineisto$completeObs

# Extract the number of supplementary variables from the dataframe
sup.vars <- c("ikä", "koulutus", "ammattiluokka", "sukupuoli", "alue", "tulotaso")
```

```{r,indexstring_to_reduce_modalities, eval = TRUE}
load("index_for_removing_mod_classifiers.RData")
#mod_luokitukset <- mod_luokitukset[!index_for_removing_mod_classifiers, "mod_luokitukset"]
```

```{r}
# Here is function to create our dataset for spesific mca. We use data matrix where NA values are present, instead of multiple imputation.

get_data_for_spesific_mca <- function(active_df, sup_df, karsittavat_str = index_str){
  
  # Get data set that includes supplementary and active variables. Exclude variables that have been determined to not be in the analysis (karsittavat_str)
  dat_with_na_levels <- data.frame(active_df[,!names(active_df) %in% karsittavat_str], sup_df) %>% 
    mutate_if(is.character, as.factor) %>% 
    mutate_each(funs(addNA(., ifany = TRUE)))
  
  # Get indices of null categories. This is important for MCA-function to conduct spesific mca. 
  index_for_null_categories <- active_df[,!names(active_df) %in% karsittavat_str] %>%
    mutate_if(is.character, as.factor) %>% 
    mutate_each(funs(addNA(., ifany = TRUE))) %>%  
    sapply(., function(x) levels(x)) %>% 
    unlist(.) %>% 
    is.na(.) %>% 
    which(. == TRUE) %>% 
    'names<-' (NULL)
  
  # Get all the factor levels in the analysis
  levels_in_analysis <- dat_with_na_levels %>%   
    sapply(., function(x) levels(x)) %>% 
    unlist(.) %>% unname(.)
  
  # Create vector of "NA1, NA2, ..., NAx", to give every NA-level unique identifier. Otherwise MCA-function includes variable name to 
  # every category which makes the map messy.
  na_levels_with_identifier <- paste0((levels_in_analysis[index_for_null_categories]), seq_len(length(index_for_null_categories)))
  
  # Loop over every NA level and replace that with NAx.
  i <- 1
  for(col in 1:ncol(dat_with_na_levels)){
    if(NA %in% levels(dat_with_na_levels[,col])){
      levels(dat_with_na_levels[,col]) <- c(levels(dat_with_na_levels[,col])[-length(levels(dat_with_na_levels[,col]))],
                                                na_levels_with_identifier[i])
      i <- i + 1
      
    }
  }
  
  # Return data and index for null categories
  list(data = dat_with_na_levels, null_categories = index_for_null_categories)
} 

```



```{r firstAnalysis}
# get data for 2007 analysis

vanha <- get_data_for_spesific_mca(matriisi_mca1_missingit, suplementary_variables1)
index_vanha_data_missingit <- apply(vanha$data[,!(names(vanha$data) %in% sup.vars)],
                                    1,
                                    function(x) sum(str_detect(x, "NA")) < 0.2 * ncol(vanha$data[,!(names(vanha$data) %in% sup.vars)]))

vanha$data <- vanha$data[index_vanha_data_missingit,]
# Create mca-analysis

analyysi_vanha <- MCA(vanha$data, 
                      ncp = 3,
                      ind.sup = NULL,
                      excl = vanha$null_categories,
                      quali.sup = which(names(vanha$data) %in% sup.vars),
                      graph = FALSE,
                      row.w = NULL # Uniform weights for observations
                      )

```

```{r secondAnalysis}
uusi <- get_data_for_spesific_mca(matriisi_mca_missingit, suplementary_variables)
index_uusi_data_missingit <- apply(uusi$data[,!(names(uusi$data) %in% sup.vars)],
                                   1,
                                   function(x) sum(str_detect(x, "NA")) < 0.2 * ncol(uusi$data[,!(names(uusi$data) %in% sup.vars)]))

uusi$data <- uusi$data[index_uusi_data_missingit,]

analyysi_uusi <- MCA(uusi$data, 
                      ncp = 5,
                      ind.sup = NULL,
                      excl = uusi$null_categories,
                      quali.sup = which(names(uusi$data) %in% sup.vars),
                      graph = FALSE,
                      row.w = NULL # Uniform weights for observations
                      )
```

```{r, thirdAnalysis}
new <- c(
  # vanhojen päivitys
  "Cheeck", "Jooga", "Banksy",
  
  # online
  "Ammuskelupelit", "Toimintapelit", "Urheilupelit", "pelaaminen_per_päivä",
  "Facebook", "Youtube", "Twitter", "Suomi24", "IS.tai.IL.keskustelupalsta", "NettiBlogit",
  "NettiUutiset", "Instagram", "MV.lehti",
  
  # arkiset
  "Puutarhanhoito", "Leipominen", "Käsityöt", "Tekniset.työt", "Kalastus", "Metsästys", "Marjastus.tai.sienestys", "Ristikot..sudokut.tai.palapelit",
  "Pelikorteilla.pelaaminen", "Lautapelien.pelaaminen", "Pihapelin.pelaaminen"
)

# Try these, modify modality classes respectfully

new_vars <- uudet_muuttujat[,names(uudet_muuttujat) %in% new]
newdat <-get_data_for_spesific_mca(cbind(matriisi_mca_missingit, new_vars), suplementary_variables)
newmods <- unname(unlist(sapply(newdat$data[,names(newdat$data) %in% new], function(x) levels(x))))
newmods <- newmods[str_detect(newmods, "NA", negate = TRUE)]

mod_luokitukset_uudet_muuttujat <- mod_luokitukset_uudet_muuttujat[mod_luokitukset_uudet_muuttujat$mod %in% newmods, 2]

index_newdat_missingit <- apply(newdat$data[,!(names(newdat$data) %in% sup.vars)], 1, function(x) sum(str_detect(x, "NA")) < 0.2 * ncol(newdat$data[,!(names(newdat$data) %in% sup.vars)]))

newdat$data <- newdat$data[index_newdat_missingit,]

newdat_mca <- MCA(newdat$data,
                  quali.sup = which(names(newdat$data) %in% sup.vars),
                  excl = newdat$null_categories,
                  ncp = 5, 
                  graph = FALSE)
```

```{r}
# Function to get number of modalities in data.frame
  mod_määrä <- function(dat){
    määrä <- sum(sapply(dat, function(x) nlevels(x)))
    määrä
  }
```

```{r, get-right-modality-classes}
tmp <- unname(unlist(sapply(analyysi_vanha$call$X[,!names(analyysi_vanha$call$X) %in% sup.vars], function(x) levels(x))))
tmp <- tmp[str_detect(tmp, "NA", negate = TRUE)]

mod_luokitukset <- mod_luokitukset[mod_luokitukset$mod %in% tmp, 2]       

```


# Introduction / Theory
# Research design

In this section we will introduce our research questions, data and methods.

## RQ:s


  * Are lifestyles, measured with large set of identical indicators of cultural practices in 2007 and 2018 in Finland, stable?
    * Have the main distinctive latent dimensions, illegitimate-legitimate and traditional-modern, remained the same or changed? Can we quantify major changes in these dimensions or in positions of individual cultural items in space of lifestyles? 
    * Onko elämäntyylien kartalla epälegitiimiin laitaan sijouttuvat yksilöt oikeasti passivisia, vai onko kyseessä metodologinen artefakti joka on seurausta siitä, ettei kyselyaineisto ole tavoittanut heidän kulttuurisia mieltymyksiään?
  * Have the ways in which cultural practices are socially structured changed in Finland during last the last 10 years, a period marked by rapid digitalization of cultural consumption and production and increased socio-political polarization? 


## Data

In the analysis, two nationally representative postal surveys from Finland are used. These surveys are collected by Statistics Finland in 2007 and 2018. These datasets are "Culture and Leisure in Finland, 2007" (n = 1388, response rate 46.3 %; sample size 3000) and "Culture and Leisure in Finland, 2018" (N = 1425, response rate 40.8 %, sample size 3500). Both of these survey consist of 17-74 year old mainland population in Finland. Surveys are cross-sectional in but they are designed to allow comparison, and there is correspondence in terms of topics covered and exact formulations of questions and items mentioned in the questions. In survey of 2018, there are also additional indicators of more contemporary cultural items, indicators for online and offline activities. Both datasets are included with a weigth variable calculated by Statistics Finland to correct non-response bias in terms of respondent's age, gender, education and residential area. In this analysis, we do not use these weights as there is only minor difference between weighted and unweighted results. We exclude individuals that have not responded in more than 20 % of the active variables (`r sum(index_vanha_data_missingit == FALSE)` observations in 2007 and `r sum(index_uusi_data_missingit == FALSE)` in 2018 datasets), as suggested by Le Roux and Rouanet (2010, 62). 


## Methods

MCA is a technique which allow representing summary of the relations existing between set of categorical variables (Di Franco 2015, 1301). As a method, MCA has inductive and explanatory nature, and it allows graphical representation of relationships between (possible plentiful) set of categorical variables in multidimensional space (Le Roux & Rouanet 2010). When applying MCA, it is expected that most of the information in the data are defined by several latent dimensios, which are extracted by this method. For interpretation, final solution is found using between 2 to 4 dimensions, which explain majority of the variance in the data. The object of applying MCA is therefore to reveal and analyze hidden structures and their dynamics in our datasets.

In this article, main analysis method is Specific Multiple Correspondence Analysis (SpeMCA, Le Roux & Rouanet 2010, 61). This variant of multiple correspondence analysis (MCA) is used to exclude “junk categories”, i.e. categories that are not in the scope of interest, say, missing values, from the analysis. We use SpeMCA to exclude categories that represent missing values from the analysis. 

We apply MCA to datasets from two different time points with identical set of variables. To examine change that has happened during eleven year period in space of lifestyles in Finland, method proposed by Le Roux & Rouanet (1998, 204), and originally Benzecri (1992, 410), is employed. We combine the data from both years, and conduct the analysis using observations from 2007 as active individuals and observations from 2018 as supplementary individuals. From this analysis, we use the coordinates of supplementary individuals in first and second axis. The Location ${p}$ of modality $i$ on axis $j$ in 2018 on space constructed from observations in 2007 can be found with $$p_{i,j} = {{1\over k}{\sum_{n = 1}^{k}{c_{i,j,n}}}\over\sqrt{\lambda{j}}}$$ where $k$ = number of respondents that chose modality ${i}$ and $\lambda{j}$ = eigenvalue of axis ${j}$.

After calculating the coordinates of modalities of 2018 in space of lifestyles of 2007, we measure distance of modalities obtained using 2007 and 2018 data. For calculation, we use Euclidean distance $d(p_{ij},q_{ij})$: $$d(p_{ij},q_{ij}) = \sqrt{(q_{i1} - p_{i1})^2 + (q_{i2} - p_{i2})^2}$$ where $p_{ij} = (p_{i1}, p_{i2})$, the coordinates of modality $i$ in first and second axis using 2007 data, and $q_{ij} = (q_{i1}, q_{i2})$, the coordinates of modality $i$ in first and second axis $j$ using 2018 data. 

Relative contribution $rctr_{l,k}$, where $l$ is class of modalities and  $j$ is the axis, is calculated in following manner:

$$rctr_{l,j} = ctr_{l,j}({1\over{\sum_{k = i}^{K}k_{l}}}{\sum_{i = 1}^{K} k_{i}\over{\sum_{i = 1}^{I}l}})$$, 

where $ctr_{l,j}$ is absolute contribution of class $l$ in axis $j$,
      ${1\over{\sum_{k = i}^{K}k_{l}}}$ is repiprocal of sum of modalities $k$ belonging to class $l$,
      ${\sum_{i = 1}^{K} k_{i}}$ is total number of modalities and
      ${\sum_{i = 1}^{I}l}$ is total number of classes $l$ in the data. 

## Variables

The space of lifestyles in constructed using set of indicators that cover wide range of cultural practices and tastes. In two first steps of the analysis, fields covered in the space of lifestyles are music, literature, art, tv and movies, sports, dressing and ruumiillisuus?, and food and drinking. To construct the map, `r ncol(vanha$data) - length(sup.vars)` active variables are used, and the number of active modalities is `r mod_määrä(vanha$data[,!(names(vanha$data) %in% sup.vars)])`. In addition to active variables in the analysis, we use also `r length(sup.vars)` supplementary, socio-economic variables, with total number of `r do.call(sum, lapply(vanha$data[,names(vanha$data) %in% sup.vars], function(x) nlevels(x)))` modalities.  Fields and the number of modalities covering them are presented in table 1. Fields with most indicators are music and literature, which both cover 20 % of all modalities in analysis. This choice of cultural indicators is used to construct two spaces of lifestyles in different time points, 2007 and 2018, with sets of identical cultural items. Full list of variables included and their distributions can be found in the appendix 1. 

The total number of observations in 2007 data is `r nrow(vanha$data)`, and `r nrow(uusi$data)` in the 2018 data. There are `r round(nrow(vanha$data) / (ncol(vanha$data)-length(sup.vars)),2)` and `r round(nrow(uusi$data) / (ncol(uusi$data)-length(sup.vars)),2)`  individuals for active category, respectively, and  `r round(nrow(newdat$data) / (ncol(newdat$data)-length(sup.vars)),2)` in the final part of our analysis. In the literature, one suggested guideline to minimum number of observations per active category is 20 (Di Franco 2015, 1305). However, author do not present any mathematical justification or citations for this precept. Despite of low number of observations per active category, we proceed to conduct our analysis with high total number of active categories.   

```{r}
# MCA for table
mca_for_table <- MCA(vanha$data, 
                      ncp = 5,
                      ind.sup = NULL,
                      excl = vanha$null_categories,
                      quali.sup = which(names(vanha$data) %in% sup.vars),
                      graph = FALSE,
                      row.w = NULL # Uniform weights for observations
                      )


create_kable <- function(table, cols = ncol(table) , otsikko){
  return(knitr::kable(table, caption = otsikko) %>%
             kable_styling(bootstrap_options = c("striped", "hover"), font_size = 12, latex_options = c("scale_down","hold_position")) %>% 
             column_spec(column = cols, width = "4cm"))
}


contributions <- data.frame(mca_for_table$var$contrib[,1:2],mod_luokitukset)
contributions %>% 
  group_by(mod_luokitukset) %>% 
  tally() %>% 
  arrange(desc(n)) %>% 
  mutate(Osuus = round(n/sum(n),2)) %>% 
  rbind(c("Yhteensä", sum(.$n), sum(.$Osuus))) %>% 
  select("Kenttä" = mod_luokitukset, "Modaliteettien määrä" = n, Osuus) %>% 
  create_kable(.,otsikko = "Kenttien koot molemmissa aineistoissa")


```

In third step of the analysis, additional indicators of lifestyle are included in the analysis. Updated table of fields and the number of modalities covering them are presented in table 2. 

```{r, Table2}
coords <- data.frame(newdat_mca$var$contrib[,1:2], mods = c(mod_luokitukset, mod_luokitukset_uudet_muuttujat))

coords %>% 
  group_by(mods) %>% 
  tally %>% 
  mutate(Osuus = round(n / sum(n),2)) %>% 
  arrange(desc(n)) %>% 
  rbind(c("Yhteensä", sum(.$n), sum(.$Osuus))) %>% 
  select("Kenttä" = mods, "Modaliteettien määrä" = n, Osuus) %>% 
  create_kable(., otsikko = "Kenttien koot täydennetyllä listalla muuttujia")

```


# Analysis

Our analysis will be conducted in three separate steps. First, we create space of lifestyles in Finland in 2007 using 146 active variables and 6 supplementary variables. After careful examination of space of lifestyles in 2007, we proceed to step 2 and conduct analysis using 2018 data with identical indicators. To examine change that has happened during 11 years, from 2007 to 2018, we use the respondents from 2018 as supplementary individuals in space constructed using individuals from 2007. In third step, we introduce new cultural practices to space of lifestyles in 2018. These new practices consist both offline and online cultural indicators, such as hunting, gardening and art by Banksy, and using the internet or playing games.   

## Space of lifestyles in 2007 and 2018 with identical set of indicators

We start our analysis by creating the spaces of lifestyles using data from 2007 and 2018. Table 1 and 2 shows four first dimensions produced by MCA by respective year. 

```{r Table3 }
# Function to calculate Benzecri modified rates

korjatut_selitysasteet <- function(data){
  options(scipen = 999)
  
  # 1. otetaan mukaan kaikki akselit, joiden ominaisarvo on suurempi kuin 1/Q, jossa
  # Q = aktiivisten muuttujien lukumäärä analyysissä
  
  Q <- ncol(data$call$X)
  eigens <- data$eig[data$eig[,1] > 1/Q,][,1]
  
  # 2. lasketaan modifoitu lambdat kaavalla (lambdai - 1/Q)^2
  
  modified_lambdat <- (eigens - 1/Q)^2
  
  # 3. Lasketaan modifoitu ominaisarvo akseleille kaavalla modifoitu_lambdai / sum(modifoitu_lambdai)
  
  modified_selitysasteet <- modified_lambdat / sum(modified_lambdat)
  
  modified_selitysasteet
}


create_kable(data.frame(Axis = 1:3, 
           Eigenvalue = round(analyysi_vanha$eig[1:3,1],3),
           "% of explained variance" = round(analyysi_vanha$eig[1:3,2],1),
           "Benzecri's modified explained variance" = round(korjatut_selitysasteet(analyysi_vanha)[1:3],3)*100
  ),otsikko =  "Vuoden 2007 datan kolmen ensimmäisen ulottuvuuden tunnusluvut")
```

```{r Table4}
create_kable(data.frame(Axis = 1:3, 
           Eigenvalue = round(analyysi_uusi$eig[1:3,1],3),
           "% of explained variance" = round(analyysi_uusi$eig[1:3,2],1),
           "Benzecri's modified explained variance" = round(korjatut_selitysasteet(analyysi_uusi)[1:3],3)*100
  ), otsikko = "Vuoden 2018 datan kolmen ensimmäisen ulottuvuuden tunnusluvut")
```

The modified rates of explained variance for two first dimensions are `r round(korjatut_selitysasteet(analyysi_vanha)[1],2)` for first axis and `r round(korjatut_selitysasteet(analyysi_vanha)[2],2)` for second axis, composing total `r round(sum(korjatut_selitysasteet(analyysi_vanha)[1], korjatut_selitysasteet(analyysi_vanha)[2]),2)` % of variance explained in the data. Compared to analysis conducted using 2007 data, in 2018 first dimension is almost equally strong in explaining variance of the data. Examining second dimension, it seems that there is a drop in explanatory power compared to analysis conducted using 2007 data, and this will be addressed later in the analysis. Together first and second axis account for `r round(sum(korjatut_selitysasteet(analyysi_uusi)[1], korjatut_selitysasteet(analyysi_uusi)[2]),2)` percent of variance according to Benzecri's modified rates. This is on par with recommended 80 % (Hjellbrekke 2018). Following axes explain considerable smaller fractions of the variance, and thus we will only interpret two first axis.

In table 3 and 4, the relative contributions of fields included in the analysis to first and second axis and in total are presented.

```{r, Table5}

calc_contributions <- function(df, year){
  
    modaliteettien_summa <- length(df$mod_luokitukset)
    n_luokat <- length(unique(df$mod_luokitukset))

  ordervec  <- df %>% 
    group_by(mod_luokitukset) %>% 
    tally() %>% 
    arrange(desc(n)) %>% 
    select("Kenttä" = mod_luokitukset, "Modaliteetien määrä" = n)
  
  
  df %>% 
    dplyr::group_by(mod_luokitukset) %>% 
    dplyr::summarize(
                     "Kontribuutio ensimmäiselle akselille" = round(sum(Dim.1) / 100, 2),
                     "Kontribuutio toiselle akselille" = round(sum(Dim.2) / 100, 2),
                     "Kontribuutio molemmille akseleille yhteensä" = round(sum(c(Dim.1, Dim.2)) / 2 / 100 ,2)) %>% 
    arrange(match(mod_luokitukset, ordervec$Kenttä)) %>% 
    add_column(.,ordervec[,2], .after = "mod_luokitukset") %>% 
    mutate(luokan_kontribuution_kerroin = (modaliteettien_summa / n_luokat) /.[,2],
      "Luokan suhteellinen kontribuutio ensimmäiselle akselille" = round(.[,3] * luokan_kontribuution_kerroin, 2),
      "Luokan suhteellinen kontribuutio toiselle akselille" = round(.[,4] * luokan_kontribuution_kerroin, 2)) %>% 
    select(-luokan_kontribuution_kerroin) %>% 
    create_kable(., otsikko = paste("Eri kenttien osuus kontribuutiosta 1. ja 2. akseliin", year))
}

coords <- data.frame(analyysi_vanha$var$contrib[,1:2], mod_luokitukset)
calc_contributions(coords, "2007")

```

```{r, Table6}

coords <- data.frame(analyysi_uusi$var$contrib[,1:2], mod_luokitukset)
calc_contributions(coords, "2018")
```

In the first axis, most contributing fields are music, literature and reading, and visual arts, which contributes total of 80 % of the first axis. In second axis, music remains the most important field in contributing the axis. Tv and movies, literature and reading and food and eating are other important contributors in second axis.  

As a result of high number of variables included in our analysis, conventional presentation of all modalitites with higher than mean contribution to the axis is not possible. In figure 1, 10 items in each axis for both years with highest and lowest coordinates are presented. 

```{r Figure1, fig.cap="First and second dimension in 2007 and 2018 analysises", fig.pos = "c", out.width = "100%"}
library(ggrepel)


yksiulotteiset_kartat <- function(dat, dim = 1, title, n = 10){
  
  
  set.seed(42)
  
  tmp <- data.frame(dat$var$coord)
  tmp$var <- row.names(tmp)
  
  if (dim == 1) names(tmp)[1] <- "dim"
  if (dim == 2) names(tmp)[2] <- "dim"
  
  nr <- nrow(tmp)
  
  tmp <- tmp[order(-tmp$dim),]
  
  lab <- paste0(dim, ". dimension")
  
  ggplot(tmp, aes(x = dim, y = 1, label = var)) +
    geom_point(color = "black", size = 1) +
    geom_text_repel(
      data = tmp[c(1:n, (nr-n):nr),],
      nudge_y      = 0.1,
      direction    = "y",
      angle        = 0,
      vjust        = 0,
      hjust        = 0,
      segment.size = 0.1
    ) +
    scale_x_continuous(breaks = round(seq(-1.6, 2, 0.2),2), limits = c(-1.3, 1.8)) +
    labs(x = lab) +
    ylim(1, 0.8) +
    coord_flip() +
    ggtitle(title) +
    theme_light() +
    theme(legend.position="none", plot.title = element_text(hjust = 0.5, size = 10))+
    theme(
      axis.line.x  = element_blank(),
      axis.ticks.x = element_blank(),
      axis.text.x  = element_blank(),
      axis.title.x = element_blank()
    )
}
p1 <- yksiulotteiset_kartat(analyysi_vanha, 1, "First dimension in 2007")
p2 <- yksiulotteiset_kartat(analyysi_vanha, 2, "Second dimensions in 2007")
p3 <- yksiulotteiset_kartat(analyysi_uusi, 1, "First dimension in 2018")
p4 <- yksiulotteiset_kartat(analyysi_uusi, 2, "Second dimensions in 2018")
gridExtra::grid.arrange (p1, p2, p3, p4, nrow = 2)

```

The first dimensions in the space of lifestyles in Finland for 2007, presented in figure 1, seems to account variation in cultural tastes, practices and knowledge according their legitimacy. Traditional highbrow practices such as visiting opera, classical music concerts or art galleries are located in far-right in the space of lifestyles. On the other end of first dimension, there are number of dislikes of highbrow activity and tastes, such as never visiting museums, classical concerts or galleries, and disliking cultural products such as classical music and blues. Only positive cultural products are in relation to watching Finnish soap opera and Big Brother. This axis seems to measure legitimacy and illegitimacy of components in space of lifestyles. On the left side of the axis, there are number of modalities that measure non-participation in any kind of actives or cultural practices, whereas on the right side of the axis there are few dislikes or never-doings.

The second dimension seems to be constructed according to traditionality or modernity of cultural products. Cultural products such as watching The Simpsons, having piercings or tattoos and visiting nightclubs are located on positive side of second dimensions. On the other end, there are likings for religious and traditional Finnish literature, folk music and Nordic walking. We consider this axis to be divided by traditionality or modernity of cultural products.

Compared to the analysis conducted with 2007 data, first and second dimensions seem to be unchanged eleven years later in 2018. First dimension shows clearly pattern of high and low legitimacy of cultural items. Most legitimate items are liking books of Flaubert and visiting opera or jazz concerts. Least legitimate items include not liking classical music, visiting museums and watching Big Brother from tv. Second dimension seems to be separated by traditionality or modernity of cultural items. Most modern items are piercings, visiting night clubs and watching The Simpsons, and most traditional items are liking books of traditional Finnish writers such as Kalle Päätalo or Laila Hirvisaari or reading "Apu" or "Seura" magazines regularly.

The space of lifestyles in Finland with 2007 data is constructed from these axes in figure 2. Traditional highbrow cultural items, such as opera and classical concerts are located in the legitimate, right side of the space, lower side of y-axis. More modern indicators of high legitimacy and cultural capital such as impressionism, jazz concerts and movies by Almadovar are located higher on the right side of the space. Some forms of legitimate culture, such as visiting museums or modern literature, are located near zero-point of y-axis, and these items are not separated by traditional-modern-distinction.

Some Traditional cultural items, such as Finnish folk music or religious or traditional literature are located in more legitimate area in space of lifestyles than other, less legitimate items, such as never eating out, not liking comedies or rock music or reading "Apu" or "Seura" magazines. In legitimate section of traditional cultural items, there are fewer negative attitudes, and vice versa. However, most of the items are located close to zero-point of illegitimate-legitimate axis.

The most illelegitime items in the space of lifestyles are never visiting theater or museum. Neither of these items are separated in traditional-modern dimension. Modern markers of low legitimacy include not having any books, never watching news from tv and liking big brother. There are not as many strong markers of traditional low legitimacy, other than never watching movies. Non-separating markers of low legitimacy in modern-traditional dimension include, in addition to never visiting museums or theaters, never visiting galleries, not liking blues music, reading tabloid magazine "7 Päivää" regularly, and watching soap opera "Salatut elämät". 

Most modern items in space of lifestyles include having piercings and tattoos, and watching The Simpsons. These items are also located in illegitimate side of the space of lifestyles. Non-separating items in illegitimate-legitimate dimensions include liking Metallica, visiting night clubs, playing floorball and reading scifi literature. Legitimate modern cultural items are modern art, art by Andy Warhol and Image-magazine.  

Some items presented in figure 2 are non-separating in neither dimension, illegitimate-legitimate or traditional-modern. Most of these items are essentially neutral, but also some interesting items are located near origo. For example, liking pizza does not separate in either dimension. Neither does having some cd-records, watching some tv, or going into walks.

In 2018, the first and second dimension are similar to space constructed using 2007 data. Perhaps the biggest change compared to previous space is that majority of the indicators have became less modern and more traditional. This might be explained identical indicators and cohort factor: the younger population, which favored more modern cultural items, were 11 years older, and if their lifestyles were stable during that time, their cultural items became less modern. Same mechanism has chanced already traditional items in 2007 to be even more traditional in 2018 (voisi selittää paremminkin, menköön nyt näin.). As a result of identical set of indicators used to construct the map in 2007 and 2018, there are no "extremely" modern items in space of lifestyles in 2018. 

Excluding the cohort effect, the space of lifestyles in 2018 seems to be very stable, particulary on the illegitimate-legitimate dimensions. Majority of most legitimate cultural items are more traditional than modern. Between traditional items, more legitimate traditional items are liking, doings or knowledge on cultural items, and less legitimate traditional items are not-liking, not-doings and ignorance (?) of cultural items, excluding entertainment from tv or magazines. Among illegitimate items, watching Big Brother is modern, whereas not watching movies is traditional item of low legitimacy.

Majority of modern cultural items have shifted towards legitimate culture. This might be explained by cohort effect and attained education of the youth. If cultural items, preferred by youth in 2007, remained as part of their lifestyles during 11 year period, during same time when youth attained their higher education, those cultural items might have gathered some additional degrees of legitimacy, since they are consumer by people in higher status groups. This mechanism is supported by the dynamic of items that have shifted towards legitimate areas of space of lifestyles, which of majority are positive doings, likings or knowings. Modern items remained in less legitimate section in space of lifestyles in 2018 are more often dislikes and not-doings. Both of these phenomenas are correlated with education (lähde). 

Similar items are near the origo of the space of lifestyles in 2018 as they were in 2007. Cultural items such as liking pizza or reading Pirkka-magazine, which is the most popular magazine in Finland. Next, investigate cloud of individuals in 2018 according to socio-economic supplementary variables. This investigation is presented in figure 6. Interprepation of these clouds of individuals in very similiar as it was for 2007 analysis in chapter 3.1 for figure 3.3.


```{r Figure2, fig.cap="The space of lifestyles in Finland 2007", fig.pos = "c", out.width = "100%"}
mca_kartta <- function(data, kriteeri, vuosi){
  
  # Nollaluokkien poistaminen
  rivit <- rownames(data$var$contrib)
  indeksöinti <- !str_detect(rivit, "0")
  rivinimet <- rownames(data$var$contrib[!indeksöinti,1:2])
  nollamods <- data.frame(rivinimet,data$var$contrib[!indeksöinti,1:2])
  nollamods <- arrange(nollamods, desc(Dim.1))
  
  vähän_kontribuoivat_nollaluokat <- nollamods[(nollamods[,2] < kriteeri & nollamods[,2] > -kriteeri) & (nollamods[,3] < kriteeri & nollamods[,3] > -kriteeri),]
  indeksöinti <- !(rownames(data$var$coord) %in% vähän_kontribuoivat_nollaluokat$rivinimet)

  
  temp <- data.frame(data$var$coord[indeksöinti,c(1,2)])
  row.names(temp) <- rownames(data$var$coord)[indeksöinti]
  
  # Selitysasteiden laskeminen
  
  korjatut_selitysasteet <- function(data){
    options(scipen = 999)
    
    # 1. otetaan mukaan kaikki akselit, joiden ominaisarvo on suurempi kuin 1/Q, jossa
    # Q = aktiivisten muuttujien lukumäärä analyysissä
    
    Q <- ncol(data$call$X)
    eigens <- data$eig[data$eig[,1] > 1/Q,][,1]
    
    # 2. lasketaan modifoitu lambdat kaavalla (lambdai - 1/Q)^2
    
    modified_lambdat <- (eigens - 1/Q)^2
    
    # 3. Lasketaan modifoitu ominaisarvo akseleille kaavalla modifoitu_lambdai / sum(modifoitu_lambdai)
    
    modified_selitysasteet <- modified_lambdat / sum(modified_lambdat)
    
    modified_selitysasteet
    
    
    # 1, 2 ja 3. akseli selittävät 
    #cat(paste("1:", round(modified_selitysasteet[1],2), "\n2:", round(modified_selitysasteet[2],2), "\n3:", round(modified_selitysasteet[3],2)))
    
    return(list(round(modified_selitysasteet[1],2), round(modified_selitysasteet[2], 2)))
  }
  
  selast <- korjatut_selitysasteet(data)
  
  xlab <- selast[[1]]
  ylab <- selast[[2]]
  
  col1 <- temp[,1]
  col2 <- temp[,2]
  vars <- rownames(temp)
  
  size = 3
  
  limx <- c(-1.4, 1.9)
  limy <- c(-1.2, 1.6)
  bre <- round(seq(-1.6, 2, 0.2),2)
  
  plot <- ggplot(data.frame(temp), aes(x = col1, y = col2))+
    geom_point(size = size / 3)+
    geom_hline(yintercept = 0, colour = "gray70") +
    geom_vline(xintercept = 0, colour = "gray70") +
    # ggrepel::geom_text_repel(aes(label=vars), box.padding = 0.35, point.padding = NA, segment.colour = "grey50", size = s)+
    geom_text(aes(label=vars),hjust=0.5, vjust=1.2, check_overlap = TRUE, size = size) +
    scale_x_continuous(breaks = bre, limits = limx) +
    scale_y_continuous(breaks = bre, limits = limy) +
    ggtitle(paste("Vuoden", vuosi, "kulttuurinen kartta")) +
    labs(x = paste("1. Dimensio, selitysaste = ", xlab), y = paste("2. Dimensio, selitysaste = ", ylab),
         subtitle = paste("Kartasta poistettu nollaluokat, joiden kontribuutio on vähäinen (<",kriteeri,")")) +
    theme_minimal() +
    theme(legend.position="none", plot.title = element_text(hjust = 0.5))
  
  return(plot)
}

mca_kartta(analyysi_vanha, 0.18, "2007")


```

```{r figure5, fig.cap="The space of lifestyles in Finland 2018.", fig.pos="c", out.width="100%"}
mca_kartta(analyysi_uusi, 0.18, "2018")
```

```{r, include = FALSE}

# MCA analysis with fields included in the space of lifestyles

mca_kartta_with_fields <- function(data, kriteeri, vuosi){
  
  # Nollaluokkien poistaminen
  rivit <- rownames(data$var$contrib)
  indeksöinti <- !str_detect(rivit, "0")
  rivinimet <- rownames(data$var$contrib[!indeksöinti,1:2])
  nollamods <- data.frame(rivinimet,data$var$contrib[!indeksöinti,1:2])
  nollamods <- arrange(nollamods, desc(Dim.1))
  
  vähän_kontribuoivat_nollaluokat <- nollamods[(nollamods[,2] < kriteeri & nollamods[,2] > -kriteeri) & (nollamods[,3] < kriteeri & nollamods[,3] > -kriteeri),]
  indeksöinti <- !(rownames(data$var$coord) %in% vähän_kontribuoivat_nollaluokat$rivinimet)
  
  
  temp <- data.frame(data$var$coord[indeksöinti,c(1,2)])
  row.names(temp) <- rownames(data$var$coord)[indeksöinti]
  
  # Selitysasteiden laskeminen
  
  korjatut_selitysasteet <- function(data){
    options(scipen = 999)
    
    # 1. otetaan mukaan kaikki akselit, joiden ominaisarvo on suurempi kuin 1/Q, jossa
    # Q = aktiivisten muuttujien lukumäärä analyysissä
    
    Q <- ncol(data$call$X)
    eigens <- data$eig[data$eig[,1] > 1/Q,][,1]
    
    # 2. lasketaan modifoitu lambdat kaavalla (lambdai - 1/Q)^2
    
    modified_lambdat <- (eigens - 1/Q)^2
    
    # 3. Lasketaan modifoitu ominaisarvo akseleille kaavalla modifoitu_lambdai / sum(modifoitu_lambdai)
    
    modified_selitysasteet <- modified_lambdat / sum(modified_lambdat)
    
    modified_selitysasteet
    
    
    # 1, 2 ja 3. akseli selittävät 
    #cat(paste("1:", round(modified_selitysasteet[1],2), "\n2:", round(modified_selitysasteet[2],2), "\n3:", round(modified_selitysasteet[3],2)))
    
    return(list(round(modified_selitysasteet[1],2), round(modified_selitysasteet[2], 2)))
  }
  
  selast <- korjatut_selitysasteet(data)
  
  # Merge the fields of modalities into the df for plotting
  
  mods <- data.frame(vars = rownames(data$var$contrib), mod_luokitukset)
  temp$vars <- rownames(temp)
  temp <- merge(mods, temp, "vars")
  
  
    
  xlab <- selast[[1]]
  ylab <- selast[[2]]
  
  col1 <- temp[,3]
  col2 <- temp[,4]
  
  size = 3
  
  limx <- c(-1.4, 1.9)
  limy <- c(-1.2, 1.6)
  bre <- round(seq(-1.6, 2, 0.2),2)
  plot <- ggplot(data.frame(temp), aes(x = col1, y = col2, color = mod_luokitukset))+
    geom_point(size = 0.9)+
    geom_hline(yintercept = 0, colour = "gray70") +
    geom_vline(xintercept = 0, colour = "gray70") +
    # ggrepel::geom_text_repel(aes(label=vars), box.padding = 0.35, point.padding = NA, segment.colour = "grey50", size = s)+
    geom_text(aes(label=vars),hjust=0.5, vjust=1.2, check_overlap = TRUE, size = 1 + 1.5) +
    scale_x_continuous(breaks = bre, limits = limx) +
    scale_y_continuous(breaks = bre, limits = limy) +
    ggtitle(paste("Vuoden", vuosi, "kulttuurinen kartta")) +
    labs(x = paste("1. Dimensio, selitysaste = ", xlab), y = paste("2. Dimensio, selitysaste = ", ylab),
         subtitle = paste("Kartasta poistettu nollaluokat, joiden kontribuutio on vähäinen (<",kriteeri,")")) +
    theme_minimal() +
    theme(legend.position="bottom", plot.title = element_text(hjust = 0.5))
  
  return(plot)
}
```
  
```{r, Figure3, fig.cap="Clouds of individuals in 2007 according to socio-ecominc variables", out.width="100%", include=FALSE}
combine_sup_var_ellipses <- function(dat){
  plot_inds_sup_vars <- function(dat, taustamuuttuja){
  df <- data.frame(taustamuuttuja = dat$call$X[taustamuuttuja], dat$ind$coord)
  df <- df[str_detect(df[[taustamuuttuja]], "NA", negate = TRUE), , drop = TRUE]
  
  #  df_ellipses <- data.frame(dat$call$X[[taustamuuttuja]], dat$ind$coord)
  ellipses <- coord.ellipse(df, npoint = 100, level.conf = 0.90)$res
  ellipses <- ellipses[!is.na(ellipses$Dim.1),]
  #  return(ellipses)  
  names(ellipses) <- c("muuttuja", "dim1", "dim2")
  var <- rlang::enquo(taustamuuttuja)
  
  limx <- c(-0.7, 1)
  limy <- c(-0.7, 1)
  bre <- round(seq(-1.6, 2, 0.2),2)
  
  #return(list(head(df), head(ellipses), dim(df), dim(ellipses)))
  
  ggplot(df, aes(x = Dim.1, y = Dim.2, color = df[,1])) +
    geom_point(size = 1) + 
  #    stat_ellipse(level = 0.90) +
    geom_hline(yintercept = 0, colour = "gray70") +
    geom_vline(xintercept = 0, colour = "gray70") +
    scale_x_continuous(breaks = bre, limits = limx) +
    scale_y_continuous(breaks = bre, limits = limy) +
    scale_color_discrete(name = "") +
    geom_path(data = ellipses, aes(x = dim1, y = dim2, color = muuttuja), size = 1.0) +
    ggtitle(var) +
    labs(x = "1. dimensio", y = "2. dimensio") +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
  }
  
  
  p1 <- plot_inds_sup_vars(dat, "ikä")
  p2 <- plot_inds_sup_vars(dat, "koulutus")
#  p3 <- plot_inds_sup_vars(dat, "ammattiluokka") # lets not include this...
  p4 <- plot_inds_sup_vars(dat, "alue")
  p5 <- plot_inds_sup_vars(dat, "tulotaso")
  p6 <- plot_inds_sup_vars(dat, "sukupuoli")
  
  gridExtra::grid.arrange(p1, p2, p4, p5, p6, ncol = 3)
}

combine_sup_var_ellipses(analyysi_vanha)
```

```{r, Figure6, fig.cap="Clouds of individuals in 2018 according to socio-ecominc variables", out.width="100%", include=FALSE}
combine_sup_var_ellipses(analyysi_uusi)
```

### Supplementary variables

In both of our analyses, we used socio-economic indicators as supplementary variables. These items included age, sex, education, income level, professional occupation classified to nine distinct groups and type of residential area. These supplementary variables projected on spaces of lifestyles are presented in figure 9.

```{r figure9, fig.cap="Supplemenatry variables in 2007 and 2018 projected on space of lifestyle in respective year", out.width="100%"}

plot_sup_vars <- function(anal, vuosi){
  df <- data.frame(anal$quali.sup$coord[,1:2],
                   colr = factor(rep(1:length(sup.vars), sapply(anal$call$X[,names(anal$call$X) %in% sup.vars], function(x){
                     if(sum(is.na(x)) == 0) {length(levels(x))}
                     else {length(levels(x)) + 1}}))))
  names(df) <- c("dim1", "dim2", "colr")
  
  df <- df[str_detect(rownames(df), "NA", negate = TRUE),] # exclude na-levels

  
  size = 5
  
  limx <- c(-1.2, 1.4)
  limy <- c(-1.2, 1.2)
  bre <- round(seq(-1.6, 2, 0.2),2)
  
  ggplot(df, aes(x = dim1, y = dim2, color = colr)) +
    geom_hline(yintercept = 0, colour = "gray70") +
    geom_vline(xintercept = 0, colour = "gray70") +
    geom_text_repel(aes(label = rownames(df)),size = size) +
    geom_point(size = size / 2)+
    scale_x_continuous(breaks = bre, limits = limx) +
    scale_y_continuous(breaks = bre, limits = limy) +
    ggtitle(paste("Vuoden", vuosi, "sosioekonomiset muuttujat heijastettuna\n kulttuuriseen karttaan")) +
    labs(x = paste("1. Dimensio"), y = paste("2. Dimensio")) +
    theme_minimal() +
    theme(legend.position="none", plot.title = element_text(hjust = 0.5))
}
p1 <- plot_sup_vars(analyysi_vanha, "2007")
p2 <- plot_sup_vars(analyysi_uusi, "2018")
gridExtra::grid.arrange(p1, p2, ncol = 2)



```

Socio-economic indicators seem to be quite stable during 11 year period. In the spaces, age groups are distributed strongly in modern-traditional axis; youngest age groups are located in the modern side and older in the traditional side of the axis. The youngest cohort in 2007, 18-24 years old, remained quite close to their position in 2018, when they had became cohort of 25-34. This suggest that for the youngest cohort, their lifestyle and consumed cultural products remained stable during this period, which is not the case for the cohort of 25-34 in 2007. They had became less modern during eleven year period, locating lower on the axis.

Our correlated supplementary variables, income level, education and occupational group, move diagonally on the space. The modalities of those variables start from the area of low legitimacy and traditionality, and as their values increase, they move towards more legitimate and modern side of the space. This mechanic seems to be stable over eleven year period. Among these modalities, most legitimate ones are being special expert and having highest educational level. Being in highest income group does not signal highest legitimacy but rather higher modernity. This might be due low number of observations being in highest income group in both years (2007 n = `r length(vanha$tulotaso[vanha$tulotaso == "yli 5000"])`, 2018 n = `r length(uusi$tulotaso[uusi$tulotaso == "yli 5000"])`). 

Being manager has became more legitimate and slightly more traditional from 2007 to 2018. On the other hand, manual workers, such as construction, process and logistic workers have shifted from modern to traditional, showing low legitimacy in both years. Farmers have became more traditional. Some non-separating occupations in neither dimension are experts and customer service workers.

Living in urban area does not separate in either dimension, as it locates close to the origo of the space. On the other hand, living in rural area, does locate in area of low legitimacy and traditionality. Being male is weakly associated to modern-illegitimate side, and being woman is associated with traditional-legitimate side of the space. However, these locations are quite close to the origo of the space. 

### Change in the location of the modalities in the space of lifestyles from 2007 to 2018

Next, we will analyze the change in the space of lifestyles from 2007 to 2018. We present cultural modalities that have highest change in their location in the space of lifestyles from 2007 to 2018 in figure 5.

```{r figure7, fig.cap="Items with highest difference in their location in space of lifestyles during 2007-2018 in Finland.", out.width="100%"}

molemmat <- molemmat[,!names(molemmat) %in% index_str]


analyysi_molemmat <- MCA(molemmat,
                             ncp=5,
                             quali.sup = which(names(molemmat) %in% sup.vars),
                             ind.sup = c((nrow(complete_vanha_aineisto$completeObs)
 + 1):nrow(molemmat)), # 2018 individuals are included as support individuals
                             graph = FALSE)



calculate_sup_vars <- function(dat, sarake){
  dim1 <- dat$ind.sup$coord[,1] # coordinates of support individuals for first dimension 
  dim2 <- dat$ind.sup$coord[,2] # Coordinates of support individuals for second dimension
  weigth <- rep(1, length(dim1)) # Vector of ones
  df <- data.frame(complete_uusi_aineisto$completeObs[,!names(complete_uusi_aineisto$completeObs) %in% index_str], dim1, dim2, weigth) # dataframe, where is imputated survey data and our coordinates
  
  temp <- split(df, df[,sarake]) # Split the data to as many sets as there are categories in the variable
  
  v1 <- temp[[1]] # data for first category
  v2 <- temp[[2]] # data for second category
  
  v1_dim1_miinus <- (sum(v1$weigth*v1$dim1)/length(v1$dim1))/sqrt(dat$eig[1,1]) # Coordinate for first category in first dimension
  v1_dim2_miinus <- (sum(v1$weigth*v1$dim2)/length(v1$dim2))/sqrt(dat$eig[2,1]) # Coordinate for first category in second dimension
  
  v2_dim1_0 <- (sum(v2$weigth*v2$dim1)/length(v2$dim1))/sqrt(dat$eig[1,1]) # Coordinate for second category in first dimension
  v2_dim2_0 <- (sum(v2$weigth*v2$dim2)/length(v2$dim2))/sqrt(dat$eig[2,1]) # Coordinate for second category in second dimension
  
  if (length(temp) == 3){  # If there are 3 categories
    
    v3 <- temp[[3]] # Data for third category
    
    v3_dim1_plus <- (sum(v3$weigth*v3$dim1)/length(v3$dim1))/sqrt(dat$eig[1,1]) # Coordinate for third category in first dimension
    v3_dim2_plus <- (sum(v3$weigth*v3$dim2)/length(v3$dim2))/sqrt(dat$eig[2,1]) # Coordinate for third category in second dimension
    
    new <- data.frame(matrix(
      data = c(
        v1_dim1_miinus, v1_dim2_miinus, # Matrix containing calculated coordinates for categories
        v2_dim1_0, v2_dim2_0,
        v3_dim1_plus, v3_dim2_plus),
      nrow=3, byrow=TRUE),
      variable2 = names(temp))                    # Add category names to matrix
    
    old <- data.frame(dat$var$coord[c(names(temp)),1:2], # Add coordinates of same active categories to its own dataframe
                      variable1 = row.names(dat$var$coord[c(names(temp)),1:2])) # Add names
    
    out <- data.frame(cbind(old, new)) # Bind original coordinates and new coordinates to data.frame 
    
    out$variable1 <- sapply(out$variable1, function(x) paste0("2007", x)) # Add indentifier in front of the category name
    out$variable2 <- sapply(out$variable2, function(x) paste0("2018", x)) # Add indentifier in front of the category name
    
    names(out) <- c("dim1_07", "dim2_07", "mod_07", "dim1_18", "dim2_18", "mod_18")
    
    return(out) # Return data.frame containing 12 coordinates and category names
  }
  
  # For two categories, same procedure but just with 4 coordinates instead of 6  
  
  new <- data.frame(matrix(
    data = c(
      v1_dim1_miinus, v1_dim2_miinus, # Matrix containing calculated coordinates for categories
      v2_dim1_0, v2_dim2_0),
    nrow=2, byrow=TRUE),
    variable2 = names(temp))                    # Add category names to matrix
  
  old <- data.frame(dat$var$coord[c(names(temp)),1:2], # Add coordinates of same active categories to its own dataframe
                    variable1 = row.names(dat$var$coord[c(names(temp)),1:2])) # Add names
  
  out <- data.frame(cbind(old, new)) # Bind original coordinates and new coordinates to data.frame 
  
  out$variable1 <- sapply(out$variable1, function(x) paste0("2007", x)) # Add indentifier in front of the category name
  out$variable2 <- sapply(out$variable2, function(x) paste0("2018", x)) # Add indentifier in front of the category name
  
  
  names(out) <- c("dim1_07", "dim2_07", "mod_07", "dim1_18", "dim2_18", "mod_18")
  
  out
  
}


# loop that function over every active variable in analysis

active_variables <- seq(2, nrow(analyysi_molemmat$var$eta2))

# Initiate analysis with first variable, bind rest of the variables to this dataframe with for loop

all_coordinates <- calculate_sup_vars(analyysi_molemmat, 1)



for(i in active_variables) all_coordinates <- rbind(all_coordinates, calculate_sup_vars(analyysi_molemmat, i)) 

# function to claculate distance of two points in two dimensional space (euclidian distance)

euclidian_distance <- function(p1, p2, q1, q2) sqrt( (q1-p1)^2 + (q2 - p2)^2 )
all_coordinates$euc_dist <- euclidian_distance(all_coordinates$dim1_07,
                                               all_coordinates$dim2_07,
                                               all_coordinates$dim1_18,
                                               all_coordinates$dim2_18)



plot_change <- function(suunta = 1, nvar = 15, sign = "+"){
  
#  all_coordinates <- all_coordinates %>% 
#    filter(str_sub(rownames(all_coordinates),-1) == sign)
  
  if(suunta == 1){
    change <- all_coordinates %>% 
      top_n(nvar, euc_dist)
    title <- "Modalities with biggest change in space of lifestyles during 2007-2018"
    limx <- c(-1.2, 1.6)
    limy <- c(-1, 1.8)
  } else if(suunta == -1){
    change <- all_coordinates %>% 
      top_n(-nvar, euc_dist)
    title <- "Modalities with smallest change in space of lifestyles during 2007-2018"
    limx <- c(-1.2, 1.6)
    limy <- c(-1, 1.8)
  } else {stop("suunta must be 1 or -1")}
  
  to_p <- data.frame(
    d1 = c(change$dim1_07, change$dim1_18),
    d2 = c(change$dim2_07, change$dim2_18),
    vuosi = c(rep("2007", nrow(change)), rep("2018", nrow(change))),
    nimi = c(change$mod_07, change$mod_18),
    pari = rep(1:nrow(change), 2))
  
  
  bre <- round(seq(-1.6, 2, 0.2),2)
  size = 3
  
  
  
  ggplot(to_p, aes(x = d1, y = d2, color = vuosi, label = nimi)) +
    geom_hline(yintercept = 0, colour = "gray70") +
    geom_vline(xintercept = 0, colour = "gray70") +
    geom_point(size = 1) +
    geom_line(aes(group = pari),color = "black", size = 0.01, linetype = "dashed", alpha = 0.8) +
    geom_text_repel(size = 4) +
    scale_x_continuous(breaks = bre, limits = limx) +
    scale_y_continuous(breaks = bre, limits = limy) +
    labs(x = "First dimension", y = "Second dimension") + 
    ggtitle(title) +
    theme_minimal() +
    theme(legend.position="none", plot.title = element_text(hjust = 0.5))
}

plot_change(1, 30, sign = "+")



```

In figure 5, some major changes in the space of lifestyles in Finland are present. Bigger trend seems to be that many of the modalities calculated using 2018 individuals are located in more legitimate and modern location in the space of lifestyles of 2007. Never watching news from tv used to be marker of low legitimacy in 2007, but in 2018 it has became non-separating item in illegitimate-legitimate dimensions. Liking comedy movies has become more modern cultural practice, whereas disliking action movies has shifted from being traditional to being less separating in traditional-modem dimensions. During 11 years, reading moderate amount (from two to nine) books per year has became sign of legitimacy, compared to 2007, when reading was perfectly non-separating in both dimensions.

Similar shift might be present when comparing clouds of individuals in 2018 and 2007. These clouds are presented in figure 6.

```{r figure8, fig.cap="Cloud of individuals of 2018 as supplementary individuals in cloud of active individuals of 2007", out.width="100%"}
inds <- rbind(data.frame(dim1 = analyysi_molemmat$ind$coord[,1],
           dim2 = analyysi_molemmat$ind$coord[,2],
           year = rep("2007", nrow(analyysi_molemmat$ind$coord))),
      data.frame(dim1 = analyysi_molemmat$ind.sup$coord[,1],
           dim2 = analyysi_molemmat$ind.sup$coord[,2],
           year = rep("2018", nrow(analyysi_molemmat$ind.sup$coord))))

limx <- c(-0.7, 1)
limy <- c(-0.7, 1)
bre <- round(seq(-1.6, 2, 0.2),2)

ggplot(inds, aes(x = dim1, y = dim2, color = year)) +
  geom_point() +
  stat_ellipse(level = 0.95) +
  geom_hline(yintercept = 0, colour = "gray70") +
  geom_vline(xintercept = 0, colour = "gray70") +
  scale_x_continuous(breaks = bre, limits = limx) +
  scale_y_continuous(breaks = bre, limits = limy) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))



```

Clouds composed of individuals from 2007 and 2018 seem to be quite similar in their location. Individuals from 2018 are slightly shifted to more legitimate and modern side of the space of lifestyles, and they are slightly more concentrated towards center of the space. In table 5, means and variances of locations in these two dimensions are presented.

```{r table7}
group_means_and_sds <- inds %>% 
  group_by(year) %>% 
  summarize("mean(1.dimension)" = mean(dim1),
            "mean(2.dimension)" = mean(dim2),
            "sd(1. dimension)" = sqrt(var(dim1)),
            "sd(2. dimension)" = sqrt(var(dim2))) %>% 
  as_tibble()

meanf1 <- summary(aov(dim1 ~ year, data = inds))
meanf2 <- summary(aov(dim2 ~ year, data = inds))
varf1 <- var.test(dim1 ~ year, data = inds)
varf2 <- var.test(dim2 ~ year, data = inds)

table3 <- data.frame(
  "2007" = as.numeric(t(group_means_and_sds[1,])),
  "2018" = as.numeric(t(group_means_and_sds[2,])),
  "F-value" = c(NA,
               meanf1[[1]][["F value"]][1],
               meanf2[[1]][["F value"]][1],
               varf1[[1]],
               varf2[[1]]),
  "p-value" = c(NA,
              meanf1[[1]][["Pr(>F)"]][1],
              meanf2[[1]][["Pr(>F)"]][1],
              varf1[[3]],
              varf2[[3]]))

table3 <- table3[-1,]
table3[,1:3] <- round(table3[,1:3], 2)
table3[,4] <- round(table3[,4], 3)
rownames(table3) <- c("mean (1. dimension)",
                      "mean (2. dimension", 
                      "sd (1. dimension)",
                      "sd (2. dimension")
create_kable(table3, otsikko = "Keskiarvot ja keskihajonnat 1. ja 2. ulottuvuudella eri vuosien havainnoilla")
```

In the first dimension, shift of individuals is towards legitimate side in space of lifestyles compared to 2007 (p = `r table3[1,4]`). In second dimension, 2018 individuals were more modern than individuals in 2007 (p < `r table3[2,4]`). Variance in both dimensions were higher among 2007 than 2018 individuals. Shift towards modern side of the space can be partly explained with cohort effect; the most traditional group in 2007 was not present in 2018 data, and oldest cohort in 2018 data was did not prefer as traditional cultural indicators as previous cohort. It is also notable that even individuals in 2018 were more modern than invidivuals in 2007, there are no individuals in 2018 that are more modern than most modern indivuals in 2007. This might be explained by identical set of indicators, picked before first survey in 2007. Items that were considered most modern in 2007 are still most modern in 2018, selitä paremmin.

Next, we examine the change in terms of movement in two main axis between 2007 and 2018 individuals in distinct sociodemographic groups. This shift is analyzed by comparing mean points of individuals that chose particular sociodemographic modality in 2007 and 2018. This analysis is presented in table x.

```{r}
get_mean_and_test_table2 <- function(muuttuja, dimensio = 1){
  coords_and_sup_vars <- data.frame(rbind(analyysi_molemmat$ind$coord[,1:2], analyysi_molemmat$ind.sup$coord[,1:2]),
                                  rbind(analyysi_molemmat$call$X[,names(analyysi_molemmat$call$X) %in% sup.vars]),
                                  aineisto = c(rep("2007", nrow(analyysi_molemmat$ind$coord)),
                                               rep("2018", nrow(analyysi_molemmat$ind.sup$coord))))

  if(dimensio == 1){
    df <- data.frame(sapply(levels(coords_and_sup_vars[[muuttuja]]), function(x) t.test(Dim.1 ~ aineisto, coords_and_sup_vars[coords_and_sup_vars[[muuttuja]] == x,])))
  }  else if(dimensio == 2){
    df <- data.frame(sapply(levels(coords_and_sup_vars[[muuttuja]]), function(x) t.test(Dim.2 ~ aineisto, coords_and_sup_vars[coords_and_sup_vars[[muuttuja]] == x,])))
  }
  df <- data.frame(t(df))
  
  tmp_df <- data.frame(
             mean_2007 = sapply(df$estimate, function(x) x[1]),
             mean_2018 =sapply(df$estimate, function(x) x[2]),
             t.test = unlist(df$statistic),
             p.value = unlist(df$p.value))
  rownames(tmp_df) <- rownames(df)           
  tmp_df <- tmp_df %>%
    rownames_to_column("tmp") %>% 
    mutate_if(is.numeric, round, 3) %>% 
    column_to_rownames("tmp")
  names(tmp_df)[1:2] <- paste0("mean_dim", dimensio, c("_2007", "_2018"))
  tmp_df
}


tb <- data.frame(
  do.call(rbind, lapply(sup.vars, function(x) get_mean_and_test_table2(x, 1))),
  do.call(rbind, lapply(sup.vars, function(x) get_mean_and_test_table2(x, 2))))

library(kableExtra)
otsikko <- "Sosiodemografisten modaliteettien keskiarvon muutos kahdella ensimmäisellä ulottuvuudella 2007 ja 2018 vastauksien mukaan. Vuoden 2007 havainnot ovat aktiivisia havaintoja ja vuoden 2018 havainnot ovat analyysissä supplementaarihavaintoja. Boldattujen rivine kohdalla muutos ainakin toisella akselilla on ollu tilastollisesti merkitsevä."
knitr::kable(tb, caption = otsikko) %>%
             kable_styling(bootstrap_options = c("striped", "hover"), font_size = 12, latex_options = c("scale_down","hold_position")) %>% 
             row_spec(which(tb$p.value < 0.05 | tb$p.value.1 < 0.05), bold = T) %>% 
             column_spec(column = ncol(tb), width = "4cm")


```


Next, we will try to find clusters from space of individuals and to identify most important cultural products for those clusters. We try to identify robust groups in space of lifestyles, and examine if there is change during eleven year period in these groups.

### Examining clusters of lifestyles in 2007 and 2018

To cluster our data, we use hierarchical clustering on principal components from FactoMineR r-package (Husson et al. 2010). Results from cluster analysis on axes obtained by multiple correspondence analysis are presented in figures 10 and 11. To determine the most proper number of clusters, we use recommended number of clusters by HCPC-function from FactoMineR-package, which seems to be 3.


```{r Figure10, fig.cap="Clusters in spaces of lifestyles in 2007 and 2018.", out.width="100%"}
clust_vanha <- HCPC(analyysi_vanha, nb.clust = -1, graph = FALSE)
clust_uusi <- HCPC(analyysi_uusi, nb.clust = -1, graph = FALSE)

# create ggplot -----------------------------------------------------------
plot_clusters <- function(clustdat){
  to_plot <- clustdat$call$X[,c("Dim 1","Dim 2","clust")]
  names(to_plot) <- c("dim1", "dim2", "group")
  ggplot(to_plot, aes(dim1, dim2, color = group)) + 
    geom_point() +
    stat_ellipse(level = 0.95) +
    geom_hline(yintercept = 0, colour = "gray70") +
    geom_vline(xintercept = 0, colour = "gray70") +
    scale_x_continuous(breaks = bre, limits = limx) +
    scale_y_continuous(breaks = bre, limits = limy) +
    ggtitle(substitute(clustdat)) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5))
}
p1 <- plot_clusters(clust_vanha)
p2 <- plot_clusters(clust_uusi)
gridExtra::grid.arrange(p1, p2, nrow = 1)


```

Based on visual inspection, clusters seem to me formed consistently, and separation is successful. There three clusters seem to be representing distinct lifestyles: First cluster, marked red in figure 7, is cluster of low legitimacy and traditional practices. Marked by green, second cluster is also mostly in the area of low legitimacy, but in modern side of second dimensions. Third cluster does not separate on traditional-modern-dimension, but rather implies high cultural capital and legitimacy. To examine results more closely, we present most important positive and negative cultural items for each cluster in both years in figure 11.

```{r Figure11, fig.cap="Most important items for cluster in 2007 and 2018", out.width="100%"}
find_most_important_categories_for_clusters <- function(dat, sign = "+", vuosi){
  
  options(scipen = 1)
  
  res <- list()
  
  for (i in seq_len(length(dat$desc.var$category))){
    df <- data.frame(dat$desc.var$category[[i]])
    df$category <- rownames(df)

    p <- df %>% 
      select(category, v.test, p.value) %>% 
      filter(str_sub(category, -1) == sign) %>% # this line can be used to filter results by last sign (+, -, 0) %>% 
      top_n(15, v.test)
    
    rownames(p) <- NULL
    
    res[[i]] <- p
    
  }
  
  res
}

olds <- find_most_important_categories_for_clusters(clust_vanha, sign = "+", vuosi = "2007")
news <- find_most_important_categories_for_clusters(clust_uusi, sign = "+", vuosi = "2018")

olds
news

```

Most important items for each cluster seems to be quite stable during eleven year period. In first cluster, the one with highest traditionality and low legitimacy, most important items for cluster membership seems to be passivity or disliking important items for other clusters. Items of liking include items such as schlager music and (maisemamaalaukset). Most important items of dislikes include rock gigs, music of Metallica, art by Warhol and night clubs.

Second, modern and mostly illegitimate cluster consist mostly of items that are related to youth culture. One interesting aspect is that during 2007, being between 18-24 years was important for cluster membership, but during 2018 being in the youngest cohort was not that important. This suggest these items, picked chosen during 2006 (?) do not reflect the cultural activities of youngest adults in 2018. Nonetheless, important items for this cluster include items such as visiting night clubs and pubs, liking Metallica, not watching news from tv, and liking hiphop and r'n'b. Dislikes include traditional finnish folk music in both years, and disliking religious music in 2007 and classical music in 2018. 

Third cluster seem to be classic highbrow cluster. Items that reflect high cultural capital and high legitimacy belong to this cluster in both year, and almost all of the items in both years are indicators of liking, participating and knowing. These items include classical music, opera, visiting museums and galleries, liking both Dostojevski and modern literature, and liking art of Kahlo and Thesleft and having more than 200 books at home. This cluster seems to be most stable during 11 year period. 


## Space of lifestyles in 2018 with additional online and offline indicators


Previous analyses were conducted using set of cultural indicators, that were available in both 2007 and 2018 data. Next, we will conduct MCA to 2018 data using set of cultural indicators that yields the most comprehensive space of lifestyles using our data. (note: Proportion of variance explained could be increased to ~78 % by dismissing "central"/not-separating cultural indicators (mökki, risteily, cheek). Maybe not worth it, when interprepting these variables is interesting?) New variables include both online and offline indicators, such as reading Helsingin Sanomat newspaper, body building, liking art of Banksy, using social media service Twitter, reading blogs online or watching videos from Youtube. Total number of new variables included is `r ncol(new_vars)`. Using these variables as active variables, the eigenvalues, proportions of explained variance and Benzecris modified rates of explained variance for first four axes are presented in table x. Contributions to the first and second axis of fields included in the analysis are presented in table X. The first and second axis of our more comprehensive space of lifestyles is presented in figure 10. These axes are presented in two-dimensional plane in figure 13, with newly included variables highlighted.

```{r, table8}
create_kable(data.frame(Axis = 1:4, 
           Eigenvalue = round(newdat_mca$eig[1:4,1],3),
           "% of explained variance" = round(newdat_mca$eig[1:4,2],1),
           "Benzecri's modified explained variance" = round(korjatut_selitysasteet(newdat_mca)[1:4],3)*100
  ), otsikko = "Kattavamman analyysin neljän ensimmäisen ulottuvuuden tunnusluvut")
```


```{r, table9}
coords <- data.frame(newdat_mca$var$contrib[,1:2], mod_luokitukset = c(mod_luokitukset, mod_luokitukset_uudet_muuttujat))
calc_contributions(coords, "kattavalla muuttujavalikoimalla")

```



```{r, figure12, fig.cap="First and second axis of Space of lifestyles in 2018 using comprehensive set of cultural indicators.", out.width = "100%"}
p1 <- yksiulotteiset_kartat(newdat_mca, 1, "First dimension in 2018 using comprehensive set of indicators", n = 15)
p2 <- yksiulotteiset_kartat(newdat_mca, 2, "Second dimensions in 2018 using comprehensive set of indicators", n = 15)
gridExtra::grid.arrange (p1, p2, nrow = 1)

```


```{r, figure13, fig.cap="Space of lifestyles in 2018 using comprehensive set of cultural indicators.", out.width="100%"}
plottaa_uudet_muuttujat <- function(analyysi_data, uudet_muuttujat, support_vars, kriteeri = 0.2){
  # Datan muokkaus ----------------------------------------------------------
  mod_määrä <- function(dat){
    määrä <- sum(sapply(dat, function(x) nlevels(x)))
    määrä
  }
  # Data
  set.seed(1)
  
  uudet_muuttujat <- uudet_muuttujat %>% mutate_if(is.character, as.factor)
  
  df_temp <- data.frame(analyysi_data[,!names(analyysi_data) %in% sup.vars],
                        data.frame(uudet_muuttujat))
  
  nrdat <- nrow(analyysi_data)
  ncdat <- ncol(analyysi_data[, !names(analyysi_data) %in% sup.vars])
  nrx <- nrow(uudet_muuttujat)
  ncx <- ncol(uudet_muuttujat)
  nlevel_uudet_muuttujat <- mod_määrä(uudet_muuttujat)
  # imputointi
  df_temp_comp <- get_data_for_spesific_mca(df_temp, support_vars) 
  
  mca_temp <- MCA(df_temp_comp$data,
                  ncp=5,
                  excl = df_temp_comp$null_categories,
                  quali.sup = which(names(df_temp_comp$data) %in% sup.vars),
                  graph = FALSE)
  # lasketaan selitysasteet
  korjatut_selitysasteet <- function(data){
    options(scipen = 999)
    # 1. otetaan mukaan kaikki akselit, joiden ominaisarvo on suurempi kuin 1/Q, jossa
    # Q = aktiivisten muuttujien lukumäärä analyysissä
    Q <- ncol(data$call$X)
    eigens <- data$eig[data$eig[,1] > 1/Q,][,1]
    # 2. lasketaan modifoitu lambdat kaavalla (lambdai - 1/Q)^2
    modified_lambdat <- (eigens - 1/Q)^2
    # 3. Lasketaan modifoitu ominaisarvo akseleille kaavalla modifoitu_lambdai / sum(modifoitu_lambdai)
    modified_selitysasteet <- modified_lambdat / sum(modified_lambdat)
    modified_selitysasteet
    # 1, 2 ja 3. akseli selittävät
    #cat(paste("1:", round(modified_selitysasteet[1],2), "\n2:", round(modified_selitysasteet[2],2), "\n3:", round(modified_selitysasteet[3],2)))
    return(list(round(modified_selitysasteet[1],3), round(modified_selitysasteet[2], 3)))
  }
  selast <- korjatut_selitysasteet(mca_temp)
  # identifioidaan uudet muuttujat (tarviiko?)
  uusien_muuttujien_identifiointi <- c(rep(1,(nrow(mca_temp$var$coord) - nlevel_uudet_muuttujat)),
                                       rep(2, nlevel_uudet_muuttujat))
  # plottauksen valmistelu
  # Poistetaan vähän kontribuoivat nollaluokat ja valmistellaan lopullinen df, josta plottaus tehdään
  määrä <- nlevel_uudet_muuttujat
  rivit <- rownames(mca_temp$var$contrib)
  indeksöinti <- !str_detect(rivit, "0")
  rivinimet <- rownames(mca_temp$var$contrib[!indeksöinti,1:2])
  nollamods <- data.frame(rivinimet,mca_temp$var$contrib[!indeksöinti,1:2])
  nollamods <- arrange(nollamods, desc(Dim.1))
  vähän_kontribuoivat_nollaluokat <- nollamods[(nollamods[,2] < kriteeri & nollamods[,2] > -kriteeri) & (nollamods[,3] < kriteeri & nollamods[,3] > -kriteeri),]
  indeksöinti <- !(rownames(mca_temp$var$coord) %in% vähän_kontribuoivat_nollaluokat$rivinimet)
  temp <- data.frame(mca_temp$var$coord[indeksöinti,c(1,2)], uusien_muuttujien_identifiointi = uusien_muuttujien_identifiointi[indeksöinti])
  row.names(temp) <- rownames(mca_temp$var$coord)[indeksöinti]
  plot_df <- split(temp, temp$uusien_muuttujien_identifiointi)
  plot_df1 <- plot_df[[1]]
  plot_df2 <- plot_df[[2]]
  # Plotataan
  col1 <- plot_df1[,1]
  col2 <- plot_df1[,2]
  vars <- rownames(plot_df1)
  size = 4
  limx <- c(-1.2, 1.9)
  limy <- c(-1.5, 1.4)
  bre <- round(seq(-1.2, 1.9, 0.2),2)
  xlab = selast[[1]]
  ylab = selast[[2]]
  col1_1 <- plot_df2[,1]
  col2_2 <- plot_df2[,2]
  vars2 <- rownames(plot_df2)
  plot <- ggplot(data.frame(plot_df1), aes(x = col1, y = col2))+
    geom_point(size = size / 4)+
    geom_hline(yintercept = 0, colour = "gray70") +
    geom_vline(xintercept = 0, colour = "gray70") +
    geom_point(data = plot_df2, aes(x = col1_1, y = col2_2), color = "red", size = size / 3, alpha = 0.9) +
    geom_label_repel(data = plot_df2, aes(x = col1_1, y = col2_2, label = vars2), color = "red",
                     hjust=0.5, vjust=1.2, size = size)+
    scale_x_continuous(breaks = bre, limits = limx) +
    scale_y_continuous(breaks = bre, limits = limy) +
    ggtitle(paste("Vuoden 2018 kulttuurinen kartta")) +
    labs(x = paste("1. Dimensio, selitysaste = ", xlab), y = paste("2. Dimensio, selitysaste = ", ylab),
         subtitle = paste("Kartasta poistettu nollaluokat, joiden kontribuutio on vähäinen (<",kriteeri,")")) +
    theme_minimal() +
    theme(legend.position="none", plot.title = element_text(hjust = 0.5)) +
    annotate("text", x = 1.4, y = -1, label = paste("Akselit yhteensä:", sum(c(xlab, ylab))))
  return(list(plot, analyysi_uudet_muuttujat = mca_temp))
}

analyysi_uudet_muuttujat <- plottaa_uudet_muuttujat(matriisi_mca_missingit, new_vars, suplementary_variables)[[2]]
plottaa_uudet_muuttujat(matriisi_mca_missingit, new_vars, suplementary_variables, 0.2)[[1]]


```

As can be seen from figure 13, the first and second dimension remained the same as in previous spaces, despite adding new cultural indicators. Introducing our new set of variables to our analysis yielded higher proportion of explained variance (24 % -> 27.5 %) in traditional-modern -axis, but lowered this proportion in first, illegitimate-legitimate -axis (52 % -> 48.4). In total, these two dimensions explain 76 % percent of the variance in our data. The increased explanation power of second axis is somewhat expected: some of the new cultural indicators, such as gaming and social media indicators, were known to be favored by younger population. As previously, we do not interpret third dimensions.  

Some of the new variables locate on the edges of the space of lifestyles. For example, playing shooter games is most modern cultural indicator in the space, locating slightly on the illegitimate side of first dimension. Liking the graffiti art of Banksy locates also to modern side of the space, but on the legitimate side of first dimension. Other modern practices that were not included in previous analysis are playing action games, playing 0-2 or +2 hours per day, bodybuilding and never foraging berries or mushrooms or never practicing gardening. All of the included online and social media indicators, such as using Instagram, Suomi24-forum, Facebook, Twitter, or fake news media MV-lehti, locate on the modern side of the space of lifestyles. Excluding MV-lehti, which locates in illegitimate side of space of lifestyles, all online and social media indicators locate in legitimate side of the space, Instagram being the most modern and Twitter being the most legitimate.

Traditional item among newly introduced variables include cultural indicators such as reading Kauppalehti or Taloussanomat newspaper, gardening and foraging berries or mushrooms, of which reading Kauppalehti or Taloussanomat newspaper is most traditional practice. It also locates on legitimate side of the space. The most traditional item in new variables is never watching Youtube. Other indicators that measure never using social media and online services, such as Instagram, Facebook or reading news from the internet, locate on the traditional and illegitimate side of the space. 

Although majority of the new variables included in our analysis are mainly separating in traditional-modern -axis, some of those are still separated greatly in terms of legitimacy. For example, reading newspaper Helsingin Sanomat and art criticism regularly locates in the legitimate side of the space, as does also practicing yoga. All of the aforementioned cultural indicators are non- or slightly separating in terms of traditional-modern-axis, unlike liking art of Banksy, which is highly modern, in addition to being legitimate cultural practice. 

Some of the new variables locate in the illegitimate side of the space. These indicators include both positive, doings and likings, and negative, never-doings and dislikes. Positive items include affordable dressing, fishing and hunting. Never reading Helsingin Sanomat newspaper or never going to city vacations are examples with low legitimacy of new items included in the analysis. In the illegitimate side of the space, never reading new from the internet is sign of traditional low legitimacy and playing games for more than 2 hours per day is indicator of modern low legitimacy practice.  

In addition to interesting indicators that locate on the edges of the space of lifestyles, some of the newly added indicators locate near the origo. These non-separating cultural indicators include items such as listening to rap artist Cheek, baking, spending time at summer cottage and having been on cruise. Not playing games at all and using Youtube are non-separating practices online practices. Considering two main dimensions in space of lifestyles, these items are not identified as legitimate, modern, traditional or illegitimate.

In figure 14, supplementary variables for analysis with complete set of indicators are presented.

```{r,  figure14, fig.cap="Supplementary variables in 2018 analysis using comprehensive set of cultural indicators.", out.width="100%"}
plot_sup_vars(analyysi_uudet_muuttujat, "2018")


```

Clustring in 2018 with additional indicators 

```{r Figure15, fig.cap="Clusters in spaces of lifestyles in 2018.", out.width="100%"}
clust_2018_whole <- HCPC(newdat_mca, nb.clust = -1, graph = FALSE)


# create ggplot -----------------------------------------------------------
plot_clusters <- function(clustdat){
  to_plot <- clustdat$call$X[,c("Dim 1","Dim 2","clust")]
  names(to_plot) <- c("dim1", "dim2", "group")
  ggplot(to_plot, aes(dim1, dim2, color = group)) + 
    geom_point() +
    stat_ellipse(level = 0.95) +
    geom_hline(yintercept = 0, colour = "gray70") +
    geom_vline(xintercept = 0, colour = "gray70") +
    scale_x_continuous(breaks = bre, limits = limx) +
    scale_y_continuous(breaks = bre, limits = limy) +
    ggtitle(substitute(clustdat)) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5))
}
p3 <- plot_clusters(clust_2018_whole)
plot(p3)


```

```{r}
new_whole <- find_most_important_categories_for_clusters(clust_2018_whole, sign = "+", vuosi = "2007")
new_whole
```


# Conclusions

  * Two dimensions are sufficient to represent space of lifestyles in Finland, both 2007 and 2018
    * Both dimensions remained quite stable during 11 year period
    * With identical set of indicators in 2007 and 2018, the explanatory power of traditional-modern axis declined, possible because of 1) cohort effect (most traditional age group got off the survey) and 2) no emerging indicators of contemporary lifestyle practices were included (e.g. gaming, online indicators), which leaded to underpresentation of cultural goods consumed by youngest age cohort, 18-24 year old young adults. This can be confirmed from Figure 3.7, where age group of 25-34 year old adults are as modern as 18-24 year old, which was not the case in 2007. Adding cultural good consumed by youngest population to the analysis, the youngest cohort became also the most modern. 
    * Considering individual items used to construct the space of lifestyles in 2007 and 2018, some cultural indicators experienced notable change in their location in the space. For example, reading at least some books turned from not being separating in neither axis in 2007 to being modern and legitimate practice.
  
  * Conducting MCA with comprehensive set of indicators revealed position of contemporary lifestyle practices in the space of lifestyles. From the indicators available in the survey but not yet included in first two steps of the analysis, majority were contributing more strongly in second, traditional-modern axis. 
  * Being involved in gaming were indicator of modern and slightly illegitimate lifestyle. Activities online and in social media were located also in modern side of the space, but more strongly in the legitimate side of the space.  

# References
# Appendix

## Appendix 1

```{r, appendix1, eval = TRUE}
tables_2007 <- lapply(vanha$data, table, exclude = TRUE)
tables_2018 <- lapply(uusi$data, table, exclude = TRUE)

tables_list <- lapply(seq_len(length(tables_2007)), function(i){
  
  if (all(which(c(length(tables_2007[[i]]), length(tables_2018[[i]])) == min(c(length(tables_2007[[i]]), length(tables_2018[[i]])))) == 1)){
    tables_2007[[i]][length(tables_2007[[i]]) + 1] <- NA
  } else if (all(which(c(length(tables_2007[[i]]), length(tables_2018[[i]])) == min(c(length(tables_2007[[i]]), length(tables_2018[[i]])))) == 2)){
  tables_2018[[i]][length(tables_2018[[i]]) + 1] <- NA
}
    
  
  data.frame(
    Variable = c(str_sub(names(tables_2007[[i]][1]), start = 1, end = nchar(names(tables_2007[[i]][1]))-1 ),
                 rep(" ", length(names(tables_2007[[i]]))-1)),
    Label = names(tables_2007[[i]]),
    Frequency_2007 = c(unname(tables_2007[[i]])),
    Frequency_2018 = c(unname(tables_2018[[i]])))
})

tables_df <- do.call(rbind, tables_list)
tables_df <- tables_df[!str_detect(tables_df$Label, "NA") & !is.na(tables_df$Label),]
tables_df <- add_column(tables_df,
                        Class = c(mod_luokitukset, rep(" ", nrow(tables_df) - length(mod_luokitukset))),
                        .before = "Frequency_2007")


create_kable(tables_df, otsikko = "Full list of indicators used to constuct identical spaces of lifestyles in 2007 and 2018 ")
```

## Appendix 2

```{r, appendix2, eval = TRUE}
new_vars_tables <- lapply(newdat$data[, which(names(newdat$data) == "Toimintapelit"):ncol(newdat$data[,!names(newdat$data) %in% sup.vars])], table, exclude = TRUE)
tables_new_list <- lapply(seq_len(length(new_vars_tables)), function(i){
  data.frame(
    Variable = c(str_sub(names(new_vars_tables[[i]][1]), start = 1, end = nchar(names(new_vars_tables[[i]][1]))-1 ),
                 rep(" ", length(names(new_vars_tables[[i]]))-1)),
    Label = names(new_vars_tables[[i]]),
    Frequency = c(unname(new_vars_tables[[i]])))
})

new_tables_df <- do.call(rbind, tables_new_list)
new_tables_df <- add_column(new_tables_df[str_detect(new_tables_df$Label, "NA", negate = TRUE),], Class = mod_luokitukset_uudet_muuttujat, .after = "Label")


create_kable(new_tables_df, otsikko = "List of additional indicators used to constuct comprehensive space of lifestyles with 2018 data")

```

