---
title: "research desing"
author: "Ossi Sirkka"
date: "7 12 2020"
output: html_document
---


# Research design

In this section we will introduce our research questions, data and methods.

## Research questions

In this article, we are interested in possible changes occurred in space of lifestyles in Finland during eleven yer period 2007-2018. This change is addressed from two perspectives; First, we want to examine how the space of lifestyles is different in 2018 compared to the space of 2007, when these spaces are measured with identical indicators. Second, we append previously created space of lifestyles with additional lifestyle indicators regarding e.g. digital and everyday practices. This research design yields two mains research questions:

  1. Has there been any observable changes in the space of lifestyles in Finland during 2007-2018, in either the main structuring dimensions or in the locations of individual cultural items?
  2. How does introducing new fields of culture, such as digital and everyday practices, to the space of lifestyles effect in the structure of space of lifestyles?
  
## Data

In the analysis, two nationally representative postal surveys from Finland are used. These surveys are collected by Statistics Finland in 2007 and 2018. These datasets are "Culture and Leisure in Finland, 2007" (n = 1388, response rate 46.3 %; sample size 3000) and "Culture and Leisure in Finland, 2018" (N = 1425, response rate 40.8 %, sample size 3500). Both of these survey consist of 17-74 year old mainland population in Finland. Surveys are cross-sectional in but they are designed to allow comparison, and there is correspondence in terms of topics covered and exact formulations of questions and items mentioned in the questions. In survey of 2018, there are also additional indicators of more contemporary cultural items, indicators for online and offline activities. Both datasets are included with a weigth variable calculated by Statistics Finland to correct non-response bias in terms of respondent's age, gender, education and residential area. In this analysis, we do not use these weights as there is only minor difference between weighted and unweighted results. We exclude individuals that have not responded in more than 20 % of the active variables (`r nrow(matriisi_mca1_missingit) - nrow(vanha$data)` observations in 2007 and `r nrow(matriisi_mca_missingit) - nrow(uusi$data)` in 2018 datasets), as suggested by Le Roux and Rouanet [-@le_roux_multiple_2010, 62]. 


## Methods

MCA is a technique which allow representing summary of the relations existing between set of categorical variables [@di_franco_multiple_2015, 1301]. As a method, MCA has inductive and explanatory nature, and it allows graphical representation of relationships between (possible plentiful) set of categorical variables in multidimensional space [@le_roux_multiple_2010]. When applying MCA, it is expected that most of the information in the data are defined by several latent dimensios, which are extracted by this method. For interpretation, final solution is found using between 2 to 4 dimensions, which explain majority of the variance in the data. The object of applying MCA is therefore to reveal and analyze hidden structures and their dynamics in our datasets.

In this article, main analysis method is Specific Multiple Correspondence Analysis [SpeMCA, @le_roux_multiple_2010, 61]. This variant of multiple correspondence analysis (MCA) is used to exclude “junk categories”, i.e. categories that are not in the scope of interest, say, missing values, from the analysis. We use SpeMCA to exclude categories that represent missing values from the analysis. 

We apply MCA to datasets from two different time points with identical set of variables. Similar analysis design is presented by Coulangeon [-@coulangeon_is_2007] and Roselund [-@rosenlund_persistence_2019], and for other studies that apply MCA to analyze change in time see for example Weingartner & Rössel [-@weingartner_changing_2019]. To examine change that has happened during eleven year period in space of lifestyles in Finland, method proposed by Le Roux & Rouanet [-@roux_chapter_1998, 204], and originally Benzecri [@benzecri_correspondence_1992, 410], is employed. We combine the data from both years, and conduct the analysis using observations from 2007 as active individuals and observations from 2018 as supplementary individuals. From this analysis, we use the coordinates of supplementary individuals in first and second axis. The Location ${p}$ of modality $i$ on axis $j$ among individuals of 2018 on space constructed from observations in 2007 can be found with $$p_{i,j} = {{1\over k}{\sum_{n = 1}^{k}{c_{i,j,n}}}\over\sqrt{\lambda{j}}}$$ where $k$ = number of respondents that chose modality ${i}$ and $\lambda{j}$ = eigenvalue of axis ${j}$.

To assert whether the change is significant, we use homogeneity tests for the axes and for the two-dimensional plane [@le_roux_multiple_2010, 85-87]. For principal axis $\lambda_i$, the test statistic $Z$, which approximates standard normal distribution, is found with $$ Z = \frac{\overline{d}}{\sqrt{V}}$$ where $\overline{d}$ is the difference in location of modality $k$ in 2007 and 2018, and $$V = \frac{N}{N - 1} \frac{\lambda_i}{\tilde{n}}$$ where $N$ is the total number of observations, and $$\tilde{n} = \frac{1}{\frac{1}{n_1} + \frac{1}{n_2}}$$ where $n_1$ is the number of observations that chose the modality in 2007 and $n_2$ is the number of observation that chose the modality in 2018. To test the difference in two-dimensional plane, we calculate $X^2$ statistics, which approximately follows $\chi^2$-distribution with 2 degrees of freedom. We find $X^2$ with $$ X^2 = \tilde{n} \frac{N - 1}{N} D^2$$ where $$D^2 = \frac{\overline{d_1}}{\lambda_1} + \frac{\overline{d_2}}{\lambda_2}$$. 

After calculating the coordinates of modalities of 2018 in space of lifestyles of 2007, we measure distance of modalities obtained using 2007 and 2018 data. To measure the change, we use Euclidean distance $d(p_{ij},q_{ij})$: $$d(p_{ij},q_{ij}) = \sqrt{(q_{i1} - p_{i1})^2 + (q_{i2} - p_{i2})^2}$$ where $p_{ij} = (p_{i1}, p_{i2})$, the coordinates of modality $i$ in first and second axis using 2007 data, and $q_{ij} = (q_{i1}, q_{i2})$, the coordinates of modality $i$ in first and second axis $j$ using 2018 data. 

Relative contribution $rctr_{l,k}$, where $l$ is class of modalities and  $j$ is the axis, is calculated in following manner:

$$rctr_{l,j} = ctr_{l,j}({1\over{\sum_{k = i}^{K}k_{l}}}{\sum_{i = 1}^{K} k_{i}\over{\sum_{i = 1}^{I}l}})$$, 

where $ctr_{l,j}$ is absolute contribution of class $l$ in axis $j$,
      ${1\over{\sum_{k = i}^{K}k_{l}}}$ is repiprocal of sum of modalities $k$ belonging to class $l$,
      ${\sum_{i = 1}^{K} k_{i}}$ is total number of modalities and
      ${\sum_{i = 1}^{I}l}$ is total number of classes $l$ in the data. 

## Variables

The space of lifestyles in constructed using set of indicators that cover wide range of cultural practices and tastes. In two first steps of the analysis, fields covered in the space of lifestyles are music, literature, art, tv and movies, sports, dressing and ruumiillisuus?, and food and drinking. To construct the map, `r ncol(vanha$data) - length(sup.vars)` active variables are used, and the number of active modalities is `r mod_määrä(vanha$data[,!(names(vanha$data) %in% sup.vars)])`. In addition to active variables in the analysis, we use also `r length(sup.vars)` supplementary, socio-economic variables, with total number of `r do.call(sum, lapply(vanha$data[,names(vanha$data) %in% sup.vars], function(x) nlevels(x)))` modalities.  Fields and the number of modalities covering them are presented in table `r tablenum <- 1 ; tablenum`. Fields with most indicators are music and literature, which both cover 20 % of all modalities in analysis. This choice of cultural indicators is used to construct two spaces of lifestyles in different time points, 2007 and 2018, with sets of identical cultural items. Full list of variables included and their distributions can be found in the appendix 1. 

The total number of observations in 2007 data is `r nrow(vanha$data)`, and `r nrow(uusi$data)` in the 2018 data. There are `r round(nrow(vanha$data) / (ncol(vanha$data)-length(sup.vars)),2)` and `r round(nrow(uusi$data) / (ncol(uusi$data)-length(sup.vars)),2)`  individuals for active category, respectively, and  `r round(nrow(newdat$data) / (ncol(newdat$data)-length(sup.vars)),2)` in the final part of our analysis. In the literature, one suggested guideline to minimum number of observations per active category is 20 (Di Franco 2015, 1305). However, author do not present any mathematical justification or citations for this precept. Despite of low number of observations per active category, we proceed to conduct our analysis with high total number of active categories. 

```{r}
# MCA for table
mca_for_table <- MCA(vanha$data, 
                      ncp = 5,
                      ind.sup = NULL,
                      excl = vanha$null_categories,
                      quali.sup = which(names(vanha$data) %in% sup.vars),
                      graph = FALSE,
                      row.w = NULL # Uniform weights for observations
                      )


create_kable <- function(table, cols = ncol(table) , otsikko){
  return(knitr::kable(table, caption = otsikko) %>%
             kable_styling(bootstrap_options = c("striped", "hover"), font_size = 12, latex_options = c("scale_down","hold_position")) %>% 
             column_spec(column = cols, width = "4cm"))
}


contributions <- data.frame(mca_for_table$var$contrib[,1:2],mod_luokitukset)
contributions %>% 
  group_by(mod_luokitukset) %>% 
  tally() %>% 
  arrange(desc(n)) %>% 
  mutate(Osuus = round(n/sum(n),2)) %>% 
  rbind(c("Yhteensä", sum(.$n), sum(.$Osuus))) %>% 
  select("Kenttä" = mod_luokitukset, "Modaliteettien määrä" = n, Osuus) %>% 
  create_kable(.,otsikko = "Kenttien koot molemmissa aineistoissa")


```

In third step of the analysis, additional indicators of lifestyle are included in the analysis. Updated table of fields and the number of modalities covering them are presented in table `r tablenum <- tablenum + 1 ; tablenum `. 

```{r, Table2}
coords <- data.frame(newdat_mca$var$contrib[,1:2], mods = c(mod_luokitukset, mod_luokitukset_uudet_muuttujat))

coords %>% 
  group_by(mods) %>% 
  tally %>% 
  mutate(Osuus = round(n / sum(n),2)) %>% 
  arrange(desc(n)) %>% 
  rbind(c("Yhteensä", sum(.$n), sum(.$Osuus))) %>% 
  select("Kenttä" = mods, "Modaliteettien määrä" = n, Osuus) %>% 
  create_kable(., otsikko = "Kenttien koot täydennetyllä listalla muuttujia")

```
